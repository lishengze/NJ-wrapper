<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="utf-8"/>
	<title>Test Socket.io Namespace</title>	
	<script src = "C:\userapi\node_modules\socket.io\node_modules\socket.io-client/socket.io.js"></script>			
</head>

<body>
	<script>
					
		var url = 'http://localhost';		
		var rootSocket = io.connect(url);			
		var userSocketClient = {};
		var myDate = new Date();
		var startTime = 0;
		var endTime = 0;
		var userNumb = 0;
		
		function connectServer() {
			alert('connnect server');
			startTime = myDate.getTime();
			userNumb = parseInt(document.getElementById("userNumber").value);
					
			for (var i = 0; i < userNumb; ++i) {
				addUser(i.toString());
			}		
		}
			
		// 注册来自服务端的消息, 需要响应的事件只注册一次.	
		rootSocket.on('ready to establish connect', function(username){
			
			userSocketClient[username] = io.connect(url + '/' + username); // stoped;	
								
			userSocketClient[username].on('connect completed', function(username){
				
				var connectedNumber = parseInt(document.getElementById("connectedNumber").value);
				document.getElementById("connectedNumber").value = connectedNumber + 1;
				
				if (connectedNumber+1 === userNumb){
					endTime = myDate.getTime();	
					document.getElementById("sumCostTime").value = endTime - startTime; 
				}
																				
			});	
			
			userSocketClient[username].on('connect_server', function(data){			
				writeData(data);								
			});
			
			userSocketClient[username].on('Get from Server', function(data){				
				writeData('Get from Server: Hi Client '+ data);				
			});
											
		});
						
		function addUser(username) {
			
			rootSocket.emit('new user', username);				
		}
	
		function loginServer(username){
			
			userSocketClient[username].emit('Login server', username);					
		}
		
		function disconnectServer (username) {
			userSocketClient[username].disconnect();
		}
	
		function testCommunicateUser(username){
						
			userSocketClient[username].emit('Get from Client', username);
		}				
		
		function writeData(Data){
						
			// alert(Data);			
			/*
			var newNode = document.createElement("p");			
			newNode.innerHTML = Data;					
			document.getElementById("div1").insertBefore(newNode);
			*/				
		}				
						
	</script>
	
	<h3>The connecting process</h3>
	<br/>
	
	<div id='div1'>
		<form>
			设定连接人数: <input value = "0" id = "userNumber"      type = "text" >
			<input value = "开始连接server" id = "connectSoServer"  type = "button"
				   onclick = "connectServer()"><br/><br/>
			已连接的人数: <input value = "0" id = "connectedNumber" type = "text"><br/><br/>
			共耗时: <input value = "0" id = "sumCostTime"      type = "text" >  ms <br/>

	</div>
	
</body>
</html>